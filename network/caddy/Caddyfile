{
    email mateusz.goral92@gmail.com
}

*.mati-lab.online {
    tls {
        dns cloudflare {env.CF_API_TOKEN}
        resolvers 8.8.8.8 1.0.0.1
        propagation_delay 60s
        propagation_timeout -1
    }

    @pihole host pihole.mati-lab.online
    handle @pihole {
        forward_auth http://authelia:9091 {
            uri /api/authz/forward-auth
            copy_headers Remote-User Remote-Groups Remote-Name Remote-Email
        }
        @pihole_root path /
        redir @pihole_root /admin 301

        reverse_proxy http://pihole:8080 {
            header_up Host {host}
            header_up X-Forwarded-Proto https
            header_up X-Forwarded-Ssl on
        }
    }

    @proxmox host proxmox.mati-lab.online
    handle @proxmox {
        forward_auth http://authelia:9091 {
            uri /api/authz/forward-auth
            copy_headers Remote-User Remote-Groups Remote-Name Remote-Email
        }
        reverse_proxy 192.168.1.11:8006 {
            transport http {
                tls_insecure_skip_verify
            }
        }
    }

    @homebridge host homebridge.mati-lab.online
    handle @homebridge {
        forward_auth http://authelia:9091 {
            uri /api/authz/forward-auth
            copy_headers Remote-User Remote-Groups Remote-Name Remote-Email
        }
        reverse_proxy 192.168.1.155 {
            header_up Host {host}
            header_up X-Forwarded-Proto https
            header_up X-Forwarded-Ssl on
        }
    }

    @uptime-kuma host uptime-kuma.mati-lab.online
    handle @uptime-kuma {
        reverse_proxy http://uptime-kuma:3001 {
            header_up Host {host}
            header_up X-Forwarded-Proto https
            header_up X-Forwarded-Ssl on
            header_up Upgrade {>Upgrade}
            header_up Connection {>Connection}
        }
    }

    @homarr host homarr.mati-lab.online
    handle @homarr {
        forward_auth http://authelia:9091 {
            uri /api/authz/forward-auth
            copy_headers Remote-User Remote-Groups Remote-Name Remote-Email
        }
        reverse_proxy http://homarr:7575 {
            header_up Host {host}
            header_up X-Forwarded-Proto https
            header_up X-Forwarded-Ssl on
        }
    }

    @homer host homer.mati-lab.online
    handle @homer {
        forward_auth http://authelia:9091 {
            uri /api/authz/forward-auth
            copy_headers Remote-User Remote-Groups Remote-Name Remote-Email
        }
        reverse_proxy http://homer:6565 {
            header_up Host {host}
            header_up X-Forwarded-Proto https
            header_up X-Forwarded-Ssl on
        }
    }

    @prometheus host prometheus.mati-lab.online
    handle @prometheus {
        forward_auth http://authelia:9091 {
            uri /api/authz/forward-auth
            copy_headers Remote-User Remote-Groups Remote-Name Remote-Email
        }
        reverse_proxy http://prometheus:9090 {
            header_up Host {host}
            header_up X-Forwarded-Proto https
            header_up X-Forwarded-Ssl on
        }
    }

    @grafana host grafana.mati-lab.online
    handle @grafana {
        forward_auth http://authelia:9091 {
            uri /api/authz/forward-auth
            copy_headers Remote-User Remote-Groups Remote-Name Remote-Email
        }
        reverse_proxy http://grafana:3000 {
            header_up Host {host}
            header_up X-Forwarded-Proto https
            header_up X-Forwarded-Ssl on
        }
    }

    @ntfy host ntfy.mati-lab.online
    handle @ntfy {
        reverse_proxy http://ntfy:80 {
            header_up Host {host}
            header_up X-Forwarded-Proto https
            header_up X-Forwarded-Ssl on
        }
    }

    @authelia host authelia.mati-lab.online
    handle @authelia {
        reverse_proxy http://authelia:9091 {
            header_up Host {host}
            header_up X-Forwarded-Proto https
            header_up X-Forwarded-Ssl on
        }
    }

    handle {
        respond "unknown host" 404
    }
}
